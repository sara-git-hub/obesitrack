{% extends "base.html" %}
{% block title %}Historique{% endblock %}

{% block content %}
<h1>Historique des prédictions</h1>
<ul id="historyList"></ul>

<script>
async function loadHistory(){
    const res = await fetch("/predict/history", {
        headers: {"Authorization": "Bearer " + localStorage.getItem("access_token")}
    });
    const predictions = await res.json();
    const ul = document.getElementById("historyList");
    ul.innerHTML = "";
    predictions.forEach(p => {
        const li = document.createElement("li");
        li.innerHTML = `
            ${p.predicted_class} 
            ${p.proba ? JSON.stringify(p.proba) : ""} 
            <button onclick="deletePrediction('${p.id}')">Supprimer</button>
        `;
        ul.appendChild(li);
    });
}

async function deletePrediction(predId){
    if(!confirm("Supprimer cette prédiction ?")) return;
    const res = await fetch(`/predict/history/${predId}`, {
        method: "DELETE",
        headers: {"Authorization": "Bearer " + localStorage.getItem("access_token")}
    });
    await res.json();
    loadHistory();
}

loadHistory();
</script>
{% endblock %}
